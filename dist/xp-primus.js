!function(t){function n(e){if(i[e])return i[e].exports;var o=i[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var i={};n.m=t,n.c=i,n.i=function(t){return t},n.d=function(t,i,e){n.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:e})},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=2)}([function(t,n,i){(function(n){const e=["close","data","destroy","end","error","offline","online","open","ready","reconnect","reconnected","state","timeout"],o="undefined"!=typeof window?window:n,s="undefined"!=typeof window?null:i(3),r=o.location||{},c=o.XP||i(4),u=o.XPEmitter||i(5),a=o.XPScript||i(6);t.exports=o.XPPrimus=new c.Class("XPPrimus",{extends:u,initialize:{promise:!0,value(t,n){c.attempt(n=>{u.call(this);c.isObject(t)||(t={url:t});c.isFalsy(t.url)||Object.assign(t,c.pick(c.parseURL(t.url),["hostname","query","port","protocol"]));this.channels={};this.adapted=!1;this.offline=!1;this.state="idle";this.options=t;this.global=this.options.global||"Primus";this.hostname=this.options.hostname||r.hostname||"";this.port=this.options.port||!this.options.hostname&&r.port||null;this.protocol=this.options.protocol||!this.options.hostname&&r.protocol||"https:";this.query=this.options.query||null;this.transformer=this.options.transformer||"websockets";this.src=c.toURL({protocol:this.protocol,hostname:this.hostname,port:this.port,pathname:"/primus/primus.io.js"});this.url=c.toURL({protocol:this.protocol,hostname:this.hostname,port:this.port,query:this.query});this.adapt=this.adapt.bind(this,n)},n)}},discard(t,n,i){if(c.isFunction(n)&&(i=n,n=t,t=void 0),c.assertArgument(c.isVoid(t)||c.isString(t,!0),1,"string"),c.assertArgument(c.isString(n,!0),2,"string"),c.assertArgument(c.isVoid(i)||c.isFunction(i),3,"Function"),t)return void this._channel(t,(t,e)=>e&&e[i?"removeListener":"removeAllListeners"](n,i));e.includes(n)||this._connect(t=>!t&&this.adaptee[i?"removeListener":"removeAllListeners"](n,i))},on(t,n,i){return c.isFunction(n)&&(i=n,n=t,t=void 0),c.assertArgument(c.isVoid(t)||c.isString(t,!0),1,"string"),c.assertArgument(c.isString(n,!0),2,"string"),c.assertArgument(c.isFunction(i),3,"Function"),t?void this._channel(t,(t,e)=>e&&e.on(n,i)):e.includes(n)?void u.prototype.on.call(this,n,i):void this._connect(t=>!t&&this.adaptee.on(n,i))},once(t,n,i){return c.isFunction(n)&&(i=n,n=t,t=void 0),c.assertArgument(c.isVoid(t)||c.isString(t,!0),1,"string"),c.assertArgument(c.isString(n,!0),2,"string"),c.assertArgument(c.isFunction(i),3,"Function"),t?void this._channel(t,(t,e)=>e&&e.once(n,i)):e.includes(n)?void u.prototype.once.call(this,n,i):void this._connect(t=>!t&&this.adaptee.on(n,i))},adapt:{callback:!0,value(t,n){let i=null;c.waterfall([t=>this.adapted?this.ready(n):t(null,this.adapted=!0),t=>s?t():new a({src:this.src},t),t=>t(null,i=s?s.createSocket({transformer:this.transformer}):window[this.global]),t=>t(null,this.adaptee=new i(this.url,{manual:!0})),t=>t(null,this.adaptee.on("close",this._handleClose.bind(this))),t=>t(null,this.adaptee.on("error",this._handleError.bind(this))),t=>t(null,this.adaptee.on("offline",this._handleOffline.bind(this))),t=>t(null,this.adaptee.on("online",this._handleOnline.bind(this))),t=>t(null,this.adaptee.on("open",this._handleOpen.bind(this))),t=>t(null,this.adaptee.on("reconnect",this._handleReconnect.bind(this))),n=>n(null,t(null,this.emit("ready")))],n)}},destroy:{callback:!0,value(t){c.waterfall([t=>this.ready(t),t=>this.adaptee.once("destroy",t)&&this.adaptee.destroy()],t)}},leave:{callback:!0,value(t,n){c.waterfall([n=>n(!c.isString(t,!0)&&c.error(500,'"channel" must be string.')),i=>this.channels[t]?this._channel(t,(n,e)=>i(n,t=e)):n(null,!1),n=>t.once("close",n)&&t.destroy(),n=>n(null,delete this.channels[t.name])],n)}},send:{callback:!0,value(t,n,i,e){c.waterfall([n=>n(!c.isString(t,!0)&&c.error(500,'"channel" must be string.')),t=>t(!c.isString(n,!0)&&c.error(500,'"event" must be string.')),t=>t(!c.isVoid(i)&&!c.isObject(i)&&c.error(500,'"data" must be Object.')),n=>this._channel(t,(i,e)=>n(i,t=e)),e=>t.send(n,i,e)],e)}},_channel:{callback:!0,enumerable:!1,value(t,n){let i=!1;c.waterfall([n=>n(!c.isString(t,!0)&&c.error(500,'"name" must be string.')),n=>n(null,this.channels[t]=this.channels[t]||new Promise((n,i)=>this._connect(e=>e?i(e):n(this.adaptee.channel(t))))),n=>this.channels[t].catch(t=>{i=!0;n(t)}).then(t=>i||n(null,t))],n)}},_connect:{callback:!0,enumerable:!1,value(t){c.waterfall([n=>this.adapt(i=>"connected"===this.state?t(i):n(i)),t=>this.adaptee.once("open",t)&&"idle"===this.state&&this.adaptee.open(this.state="connecting")],t)}},adapted:{set(t){return this.adapted||!!t}},adaptee:{set(t){return this.adaptee||t},validate(t){return!c.isObject(t)&&"Object"}},channels:{set(t){return this.channels||t},validate(t){return!c.isObject(t)&&"Object"}},global:{set(t){return this.global||t},validate(t){return!c.isString(t,!0)&&"string"}},hostname:{set(t){return this.hostname||t},validate(t){return!c.isString(t,!0)&&"string"}},offline:{set(t){return!!t}},port:{set(t){return c.isDefined(this.port)?this.port:t},validate(t){return!c.isNull(t)&&!c.isNumeric(t,!0)&&"number"}},protocol:{set(t){return this.protocol||t},validate(t){return!c.isString(t,!0)&&"string"}},query:{set(t){return c.isDefined(this.query)?this.query:t},validate(t){return!c.isNull(t)&&!c.isObject(t)&&"Object"}},src:{set(t){return this.src||t},validate(t){return!c.isString(t,!0)&&"string"}},state:{set(t){return t},then(t){this.emit("state",t)},validate(t){return!this.states.includes(t)&&"string"}},states:{frozen:!0,writable:!1,value:["connected","connecting","disconnected","idle"]},transformer:{set(t){return this.transformer||t},validate(t){return!this.transformers.includes(t)&&this.transformers.split(", ")}},transformers:{frozen:!0,writable:!1,value:["browserchannel","engine.io","faye","sockjs","uws","websockets"]},url:{set(t){return this.url||t},validate(t){return!c.isString(t,!0)&&"string"}},_handleClose(){this.state="disconnected"},_handleError(t){"connecting"===this.state&&(this.state="disconnected"),this.emit("error",t)},_handleOffline(){this.offline=!0,this.emit("offline")},_handleOnline(){this.offline=!1,this.emit("online")},_handleOpen(){this.state="connected"},_handleReconnect(){this.state="connecting"}})}).call(n,i(1))},function(t,n){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,n,i){t.exports=i(0)},function(t,n){t.exports=Primus},function(t,n){t.exports=XP},function(t,n){t.exports=XPEmitter},function(t,n){t.exports=XPScript}]);